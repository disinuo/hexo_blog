解决高可用，只有一个方法，就是冗余。

通过冗余更多的机器，来应对机器的硬件故障或者彼此之间的网络故障。

除此以外，我们还需要提一点，就是防止系统被瞬间的异常拖死，也就是系统能够自己保护好自己。

异常有内外两种，一种是外部流量特别高，一种是某一个依赖故障导致系统响应变慢。

这里的课题应该包括：

熔断

限流

#### 多机房部署

**同城多机房**：延迟1～3ms

主要看接口的实现（如果有几十次的跨机房交互，这种是不可接受的）

实现相对比较简单

单机房写入；每一个机房近读取本机房的缓存与数据

如果数据发生变更，需要做两边机房缓存的清理，一般通过canal订阅数据库变更

![同城多活示意图](http://cdn.b5mang.com/202132021118.png)

**国内异地多机房**:延迟50ms以内

尽量减少跨机房的调用；而应该避免跨机房的数据库与缓存操作

多机房写入，按照用户或者其他业务维度来进行流量分割，使得一部分流量总是请求A机房，而另外的总是请求B机房。

数据同步方式有两种：
（1）基于存储系统主从复制：同步redis、Mysql等
（2）基于消息队列：同步缓存、HBase的数据

![异步多活示意图]](http://cdn.b5mang.com/20213202149.png)

**跨国多机房**：延迟在100～200ms

避免跨机房的调用，而只能做异步同步