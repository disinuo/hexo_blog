
感觉一下提高1个9，难度有多大：

三个9: 非核心业务可以容忍

四个9: 核心业务

运维值班体系、业务变更流程、故障处理流程、更加完善的系统故障排查工具

五个9: 必须让机器来自动处理恢复！

两个方面来提高系统可用性：

（1）系统设计-尽量思考故障发生后应该怎么办

考虑点：如何自动的发现故障、如何自动化的应对故障

具体方法：failover(故障转移)、超时控制、服务降级、熔断限流

failover:

- 完全对等
- 非完全对等（例如存在主备节点，心跳，选择paxos, raft等）

解决高可用，只有一个方法，就是冗余。

通过冗余更多的机器，来应对机器的硬件故障或者彼此之间的网络故障。

除此以外，我们还需要提一点，就是防止系统被瞬间的异常拖死，也就是系统能够自己保护好自己。

异常有内外两种，一种是外部流量特别高，一种是某一个依赖故障导致系统响应变慢。

这里的课题应该包括：

熔断

限流

超时控制

全局超时控制

服务降级（区分核心流程与非核心流程）

限流

熔断

（2）系统运维-尽量避免故障发生

灰度发布（确保服务可回滚）

故障演练

#### 多机房部署

**同城多机房**：延迟1～3ms

主要看接口的实现（如果有几十次的跨机房交互，这种是不可接受的）

实现相对比较简单

单机房写入；每一个机房近读取本机房的缓存与数据

如果数据发生变更，需要做两边机房缓存的清理，一般通过canal订阅数据库变更

![同城多活示意图](http://cdn.b5mang.com/202132021118.png)

**国内异地多机房**:延迟50ms以内

尽量减少跨机房的调用；而应该避免跨机房的数据库与缓存操作

多机房写入，按照用户或者其他业务维度来进行流量分割，使得一部分流量总是请求A机房，而另外的总是请求B机房。

数据同步方式有两种：
（1）基于存储系统主从复制：同步redis、Mysql等
（2）基于消息队列：同步缓存、HBase的数据

![异步多活示意图]](http://cdn.b5mang.com/20213202149.png)

**跨国多机房**：延迟在100～200ms

避免跨机房的调用，而只能做异步同步