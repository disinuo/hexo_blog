---
title: 系统架构
date: 2021-01-19 23:23:03
updated:
mathjax: true
categories:
- [系统设计]
tags: 
---

## 高并发系统的三个目标与挑战

高并发是一个系统的**挑战**

如何衡量一个系统的并发有多高呢？ 同时在线人数

高性能、高可用、可扩展是一个牛B系统**目标**

### 如何衡量一个吞吐量有多大呢？

    系统的QPS，吞吐量 = 并发进程数 / 响应时间

### 如何衡量一个系统的性能有多高呢？   
    
    接口响应时间，分位耗时

### 如何衡量一个系统的可用性有多高呢？  
    
    平均故障间隔，平均故障恢复时间

![不同可用性标准下允许的故障时间](http://cdn.b5mang.com/202132011926.png)

### 如何衡量一个系统的可扩展能力？

    考察一个问题：能够通过增加进程来应对更高的并发？ 如果一直加机器，我一直能线性的提高系统的处理能力吗？

### 高性能

提高吞吐量：

1. 增加并发进程数

注意：无限增加，不会无限提升性能(对系统的扩展性有要求)

![性能拐点模型](http://cdn.b5mang.com/202132011337.png)

2. 减少响应时间

IO密集型：优化数据库索引、加缓存

CPU密集型：优化算法时间复杂度、减少不必要运算等

### 高可用

plan挂了之后，系统能不能活下来？ 有没有负责兜底的PlanB。


### 可扩展

数据库、缓存、依赖的第三方、复杂均衡、交换机带宽都是系统扩展时需要考虑的点

数据库：按照业务拆分、分库分表

业务层：按照业务拆分、按照重要性拆分（核心、非核心）、按照请求来源（客户端、web、内网等）

分层的原因：本质上是为了让系统有更好的可扩展能力。

![架构分层](http://cdn.b5mang.com/2021320104242.png)

manager层：

1. 抽象service层可能提供的一些原子能力
2. 封装对第三方接口的调用
 
## 高准确系统，遇上高并发

高准确，也就是高一致性，例如秒杀系统中会遇到的库存问题。

## 如何应对系统的挑战

架构通用原则：“4 要 1 不要”

(1) 数据要尽量少

- 用户请求的数据能少就少
- 系统依赖的数据能少就少

(2) 请求数要尽量少

例如，静态文件合并

（3）路径要尽量短

将强依赖的服务进行单机部署

（4）依赖要尽量少

系统服务分级，高等级服务尽量少依赖低等级服务

（5）不要有单点

服务无状态，可扩展；存储层做副本备份
